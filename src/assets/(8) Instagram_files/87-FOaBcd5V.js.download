;/*FB_PKG_DELIM*/

__d("LSDeleteThenInsertAdminApprovalRequest",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.filter(t.db.table(26).fetch([[[e[0],e[1]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&t.i64.eq(t.i64.cast([0,0]),t.i64.cast([0,0]))&&t.i64.eq(n.contactId,e[1])&&t.i64.gt(n.authorityLevel,e[3])}).next().then(function(n){var r=n.done,o=n.value;return r?t.db.table(26).put({threadKey:e[0],contactId:e[1],authorityLevel:e[3],subscribeSource:e[2]}):0})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxDeleteThenInsertAdminApprovalRequestStoredProcedure",e.__tables__=["group_membership_approval_requests"],a.exports=e}),null);
__d("LSDeleteThenInsertMessage",[],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],n=[],r=[];return t.sequence([function(n){return t.db.table(12).fetch([[[e[9]]],"optimistic"]).next().then(function(n,r){var o=n.done,a=n.value;return o?t.db.table(12).add({threadKey:e[3],timestampMs:e[5],messageId:e[8],offlineThreadingId:e[9],authorityLevel:e[2],primarySortKey:e[6],senderId:e[10],isAdminMessage:e[12],sendStatus:e[15],sendStatusV2:e[16],text:e[0],subscriptErrorMessage:e[1],secondarySortKey:e[7],stickerId:e[11],messageRenderingType:e[13],isUnsent:e[17],unsentTimestampMs:e[18],mentionOffsets:e[19],mentionLengths:e[20],mentionIds:e[21],mentionTypes:e[22],replySourceId:e[23],replySourceType:e[24],replySourceTypeV2:e[25],replyStatus:e[26],replySnippet:e[27],replyMessageText:e[28],replyToUserId:e[29],replyMediaExpirationTimestampMs:e[30],replyMediaUrl:e[31],replyMediaPreviewWidth:e[33],replyMediaPreviewHeight:e[34],replyMediaUrlMimeType:e[35],replyMediaUrlFallback:e[36],replyCtaId:e[37],replyCtaTitle:e[38],replyAttachmentType:e[39],replyAttachmentId:e[40],replyAttachmentExtra:e[41],isForwarded:e[42],forwardScore:e[43],hasQuickReplies:e[44],adminMsgCtaId:e[45],adminMsgCtaTitle:e[46],adminMsgCtaType:e[47],cannotUnsendReason:e[48],textHasLinks:e[49],viewFlags:e[50],displayedContentTypes:e[51],viewedPluginKey:e[52],viewedPluginContext:e[53],quickReplyType:e[54],hotEmojiSize:e[55],platformXmdEncoded:e[56],sendAttributionXmd:e[57],replySourceTimestampMs:e[58],ephemeralDurationInSec:e[59],msUntilExpirationTs:e[60],ephemeralExpirationTs:e[61],takedownState:e[62],isCollapsed:e[63],subthreadKey:e[64],botResponseId:e[65],metadataDataclass:e[66],editCount:e[67],isPaidPartnership:e[68],adminSignatureName:e[69],adminSignatureProfileUrl:e[70],adminSignatureCreatorType:e[71],replyMessageHiddenState:e[72],translatedText:e[73],textDialect:e[74],translatedTextDialect:e[75],scheduledTimestamp:e[76],isVideoQuickSend:e[77],subthreadParentMessageId:e[78],isExclusiveToSubthread:e[79]}):(r=a.item,t.i64.le(r.authorityLevel,e[2])?t.db.table(12).put({threadKey:e[3],timestampMs:e[5],messageId:e[8],offlineThreadingId:e[9],authorityLevel:e[2],primarySortKey:r.primarySortKey,senderId:e[10],isAdminMessage:e[12],sendStatus:e[15],sendStatusV2:e[16],text:e[0],subscriptErrorMessage:e[1],secondarySortKey:r.secondarySortKey,stickerId:e[11],messageRenderingType:e[13],isUnsent:e[17],unsentTimestampMs:e[18],mentionOffsets:e[19],mentionLengths:e[20],mentionIds:e[21],mentionTypes:e[22],replySourceId:e[23],replySourceType:e[24],replySourceTypeV2:e[25],replyStatus:e[26],replySnippet:e[27],replyMessageText:e[28],replyToUserId:e[29],replyMediaExpirationTimestampMs:e[30],replyMediaUrl:e[31],replyMediaPreviewWidth:e[33],replyMediaPreviewHeight:e[34],replyMediaUrlMimeType:e[35],replyMediaUrlFallback:e[36],replyCtaId:e[37],replyCtaTitle:e[38],replyAttachmentType:e[39],replyAttachmentId:e[40],replyAttachmentExtra:e[41],isForwarded:e[42],forwardScore:e[43],hasQuickReplies:e[44],adminMsgCtaId:e[45],adminMsgCtaTitle:e[46],adminMsgCtaType:e[47],cannotUnsendReason:e[48],textHasLinks:e[49],viewFlags:e[50],displayedContentTypes:e[51],viewedPluginKey:e[52],viewedPluginContext:e[53],quickReplyType:e[54],hotEmojiSize:e[55],platformXmdEncoded:e[56],sendAttributionXmd:e[57],replySourceTimestampMs:e[58],ephemeralDurationInSec:e[59],msUntilExpirationTs:e[60],ephemeralExpirationTs:e[61],takedownState:e[62],isCollapsed:e[63],subthreadKey:e[64],botResponseId:e[65],metadataDataclass:e[66],editCount:e[67],isPaidPartnership:e[68],adminSignatureName:e[69],adminSignatureProfileUrl:e[70],adminSignatureCreatorType:e[71],replyMessageHiddenState:e[72],translatedText:e[73],textDialect:e[74],translatedTextDialect:e[75],scheduledTimestamp:e[76],isVideoQuickSend:e[77],subthreadParentMessageId:e[78],isExclusiveToSubthread:e[79]}):t.resolve())})},function(e){return t.resolve(r)}])}e.__sproc_name__="LSMailboxDeleteThenInsertMessageStoredProcedure",e.__tables__=["messages"],a.exports=e}),null);
__d("LSSetPinnedMessage",["LSIssueNewTask"],(function(t,n,r,o,a,i){function e(){var e=arguments,t=e[e.length-1],r=[],o=[];return t.sequence([function(o){return t.sequence([function(o){return r[0]=new t.Map,r[0].set("thread_key",e[0]),r[0].set("message_id",e[1]),r[0].set("pinned_message_state",e[3]),r[1]=t.toJSON(r[0]),t.storedProcedure(n("LSIssueNewTask"),"set_pinned_message_search",t.i64.cast([0,751]),r[1],void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]),void 0,void 0,t.i64.cast([0,0]),t.i64.cast([0,0]))},function(n){return t.i64.eq(e[3],t.i64.cast([0,1]))?t.sequence([function(n){return t.forEach(t.db.table(205).fetch([[[e[0],e[1]]]]),function(e){return e.delete()})},function(n){return t.forEach(t.filter(t.db.table(205).fetch([[[e[0],e[1],e[2]]]]),function(n){return t.i64.eq(n.threadKey,e[0])&&n.messageId===e[1]&&t.i64.eq(n.pinnedTimestampMs,e[2])&&t.i64.lt(n.authorityLevel,t.i64.cast([0,80]))}),function(e){return e.delete()})},function(n){return t.db.table(205).add({threadKey:e[0],messageId:e[1],pinnedTimestampMs:e[2],authorityLevel:t.i64.cast([0,80])})}]):t.forEach(t.db.table(205).fetch([[[e[0],e[1]]]]),function(e){return e.delete()})}])},function(e){return t.resolve(o)}])}e.__sproc_name__="LSMailboxSetPinnedMessageStoredProcedure",e.__tables__=["msg_pinned_messages_v2"],a.exports=e}),null);